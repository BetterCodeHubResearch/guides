<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Patterns - RubyGems Guides</title>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta http-equiv="Description" name="Description" content="Tutorials, guides, FAQs for RubyGems package management" />
    <meta http-equiv="Keywords" name="Keywords" content="rubygems, gems, programming, ruby, packages" />
    <script src="//use.typekit.net/lkc4mmu.js" type="text/javascript"></script>
    <script>
      try{Typekit.load();}catch(e){}
    </script>
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>
      $(function() {
        var path = window.location.pathname;
        $('a[href="'+path.substring(0, path.length -1)+'"]').addClass('is-active');
      });
    </script>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" name="viewport">
    <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
    <!--[if !IE]>-->
      <meta name="viewport" content="width=device-width">
      <script type="text/javascript">
        window.scrollTo(0, 1);
      </script>
    <!--<![endif]-->
  </head>

  <body class="default">
    <header class="header header--interior">
      <div class="l-wrap--header">
        <a class="header__logo-wrap" href="/">
          <span class="header__logo" data-icon="⬡">⬢</span>
          <span class="t-hidden">RubyGems</span>
        </a>
        <a class="header__club-sandwich" href="#">
          <span class="t-hidden">Navigation menu</span>
        </a>

        <div class="header__nav-links-wrap">
          <form class="header__search-wrap">
            <input class="header__search" id="header__search" name="header__search" placeholder="Search Gems..." type="search">
            <label class="header__search__icon" data-icon="⌕" for="header__search">
              <span class="t-hidden">Search gems</span>
            </label>
          </form>

          <nav class="header__nav-links">
            <a class="header__nav-link" href="/gems">Gems</a>
            <a class="header__nav-link" href="/guides">Guides</a>
            <a class="header__nav-link" href="/contribute">Contribute</a>
            <a class="header__nav-link" href="#" id="js-sign-in-trigger">Sign In</a>
            <a class="header__nav-link js-sign-up-trigger" href="#">Sign Up</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="main--interior">
      <div class="l-wrap--b">
        <a class="t-display page__heading" href="/">Guides</a>
        <div class="l-overflow">
          <div class="l-col--l">
            <div class="nav--v">
              <a class="nav--v__link" href="/rubygems-basics">RubyGems Basics</a>
              <a class="nav--v__link" href="/what-is-a-gem">What is a gem?</a>
              <a class="nav--v__link" href="/make-your-own-gem">Make your own gem</a>
              <a class="nav--v__link" href="/gems-with-extensions">Gems with Extensions</a>
              <a class="nav--v__link" href="/name-your-gem">Name your gem</a>
              <a class="nav--v__link" href="/publishing">Publishing your gem</a>
              <a class="nav--v__link" href="/security">Security Practices</a>
              <a class="nav--v__link" href="/patterns">Patterns</a>
              <a class="nav--v__link" href="/specification-reference">Specification Reference</a>
              <a class="nav--v__link" href="/command-reference">Command Reference</a>
              <a class="nav--v__link" href="http://docs.seattlerb.org/rubygems">RubyGems API</a>
              <a class="nav--v__link" href="/rubygems-org-api">RubyGems.org API</a>
              <a class="nav--v__link" href="/run-your-own-gem-server">Run your own gem server</a>
              <a class="nav--v__link" href="/resources">Resources</a>
              <a class="nav--v__link" href="/contributing">Contributing to RubyGems</a>
              <a class="nav--v__link" href="/faqs">Frequently Asked Questions</a>
              <a class="nav--v__link" href="/plugins">Plugins</a>
              <a class="nav--v__link" href="/credits">Credits</a>
            </div>
          </div>
          <div class="l-colspan--r">
            <div class="t-body">
              <p><em class="t-gray">Common practices to make your gem users’ and other developers’ lives easier.</em></p>

<ul>
  <li><a href="#consistent-naming">Consistent naming</a></li>
  <li><a href="#semantic-versioning">Semantic versioning</a></li>
  <li><a href="#declaring-dependencies">Declaring dependencies</a></li>
  <li><a href="#loading-code">Loading code</a></li>
  <li><a href="#prerelease-gems">Prerelease gems</a></li>
</ul>

<h2 id="consistent-naming">Consistent naming</h2>

<blockquote>
  <p>There are only two hard things in Computer Science: cache invalidation and naming things.
-<a href="http://martinfowler.com/bliki/TwoHardThings.html">Phil Karlton</a></p>
</blockquote>

<h3 id="file-names">File names</h3>

<p>Be consistent with how your gem files in <code>lib</code> and <code>bin</code> are named. The
<a href="https://github.com/qrush/hola">hola</a> gem from the <a href="/make-your-own-gem">make your own
gem</a> guide is a great example:</p>

<pre><code>% tree
.
├── Rakefile
├── bin
│   └── hola
├── hola.gemspec
├── lib
│   ├── hola
│   │   └── translator.rb
│   └── hola.rb
└── test
    └── test_hola.rb
</code></pre>

<p>The executable and the primary file in <code>lib</code> are named the same. A developer
can easily jump in and call <code>require 'hola'</code> with no problems.</p>

<h3 id="naming-your-gem">Naming your gem</h3>

<p>Naming your gem is important.  Before you pick a name for your gem, do a
quick search on <a href="http://rubygems.org">RubyGems.org</a> and
<a href="https://github.com/search">GitHub</a> to see if someone else has taken it.  Every
published gem must have a unique name.  Be sure to read our <a href="/name-your-gem">naming
recommendations</a> when you’ve found a name you like.</p>

<h2 id="semantic-versioning">Semantic versioning</h2>

<p>A versioning policy is merely a set of simple rules governing how version
numbers are allocated. It can be very simple (e.g. the version number is a
single number starting with 1 and incremented for each successive version), or
it can be really strange (Knuth’s TeX project had version numbers: 3,
3.1, 3.14, 3.141, 3.1415; each successive version added another digit to PI).</p>

<p>The RubyGems team urges gem developers to follow the
<a href="http://semver.org">Semantic Versioning</a> standard for their gem’s versions. The
RubyGems library itself does not enforce a strict versioning policy, but using
an “irrational” policy will only be a disservice to those in the community who
use your gems.</p>

<p>Suppose you have a ‘stack’ gem that holds a <code>Stack</code> class with both <code>push</code> and
<code>pop</code> functionalty. Your <code>CHANGELOG</code> might look like this if you use
semantic versioning:</p>

<ul>
  <li><strong>Version 0.0.1</strong>: The initial <code>Stack</code> class is released.</li>
  <li><strong>Version 0.0.2</strong>: Switched to a linked list implementation because it is
cooler.</li>
  <li><strong>Version 0.1.0</strong>: Added a <code>depth</code> method.</li>
  <li><strong>Version 1.0.0</strong>: Added <code>top</code> and made <code>pop</code> return <code>nil</code> (<code>pop</code> used to
return the old top item).</li>
  <li><strong>Version 1.1.0</strong>: <code>push</code> now returns the value pushed (it used it return
<code>nil</code>).</li>
  <li><strong>Version 1.1.1</strong>: Fixed a bug in the linked list implementation.</li>
  <li><strong>Version 1.1.2</strong>: Fixed a bug introduced in the last fix.</li>
</ul>

<p>Semantic versioning boils down to:</p>

<ul>
  <li><strong>PATCH</strong> <code>0.0.x</code> level changes for implementation level detail changes, such
as small bug fixes</li>
  <li><strong>MINOR</strong> <code>0.x.0</code> level changes for any backwards compatible API changes,
such as new functionality/features</li>
  <li><strong>MAJOR</strong> <code>x.0.0</code> level changes for backwards <em>incompatible</em> API changes,
such as changes that will break existing users code if they update</li>
</ul>

<h2 id="declaring-dependencies">Declaring dependencies</h2>

<p>Gems work with other gems. Here are some tips to make sure they’re nice to each
other.</p>

<h3 id="runtime-vs-development">Runtime vs. development</h3>

<p>RubyGems provides two main “types” of dependencies: runtime and development.
Runtime dependencies are what your gem needs to work (such as
<a href="http://rubygems.org/gems/rails">rails</a> needing
<a href="http://rubygems.org/gems/activesupport">activesupport</a>).</p>

<p>Development dependencies are useful for when someone wants to make
modifications to your gem. When you specify development dependencies, another
developer can run <code>gem install --dev your_gem</code> and RubyGems will grab both sets
of dependencies (runtime and development). Typical development dependencies
include test frameworks and build systems.</p>

<p>Setting dependencies in your gemspec is easy. Just use <code>add_runtime_dependency</code>
and <code>add_development_dependency</code>:</p>

<pre><code>Gem::Specification.new do |s|
  s.name = "hola"
  s.version = "2.0.0"
  s.add_runtime_dependency "daemons",
    ["= 1.1.0"]
  s.add_development_dependency "bourne",
    ["&gt;= 0"]
</code></pre>

<h3 id="dont-use-gem-from-within-your-gem">Don’t use <code>gem</code> from within your gem</h3>

<p>You may have seen some code like this around to make sure you’re using a
specific version of a gem:</p>

<pre><code>gem "extlib", "&gt;= 1.0.8"
require "extlib"
</code></pre>

<p>It’s reasonable for applications that consume gems to use this (though they
could also use a tool like <a href="http://bundler.io">Bundler</a>). Gems themselves
<strong>should not</strong> do this. They should instead use dependencies in the gemspec so
RubyGems can handle loading the dependency instead of the user.</p>

<h3 id="pessimistic-version-constraint">Pessimistic version constraint</h3>

<p>If your gem properly follows <a href="http://semver.org">semantic versioning</a> with its
versioning scheme, then other Ruby developers can take advantage of this when
choosing a version constraint to lock down your gem in their application.</p>

<p>Let’s say the following releases of a gem exist:</p>

<ul>
  <li><strong>Version 2.1.0</strong> — Baseline</li>
  <li><strong>Version 2.2.0</strong> — Introduced some new (backward compatible) features.</li>
  <li><strong>Version 2.2.1</strong> — Removed some bugs</li>
  <li><strong>Version 2.2.2</strong> — Streamlined your code</li>
  <li><strong>Version 2.3.0</strong> — More new features (but still backwards compatible).</li>
  <li><strong>Version 3.0.0</strong> — Reworked the interface. Code written to version 2.x might
not work.</li>
</ul>

<p>Someone who wants to use your gem has determined that version 2.2.0 works with
their software, but version 2.1.0 doesn’t have a feature they need. Adding a
dependency in a gem (or a <code>Gemfile</code> from Bundler) might look like:</p>

<pre><code># gemspec
spec.add_runtime_dependency 'library',
  '&gt;= 2.2.0'

# bundler
gem 'library', '&gt;= 2.2.0'
</code></pre>

<p>This is an “optimistic” version constraint. It’s saying that all changes from
2.x on <em>will</em> work with my software, but for version 3.0.0 this will not be
true.</p>

<p>The alternative here is to be “pessimistic”. This explicitly excludes the
version that might break your code.</p>

<pre><code># gemspec
spec.add_runtime_dependency 'library',
  ['&gt;= 2.2.0', '&lt; 3.0']

# bundler
gem 'library', '&gt;= 2.2.0', '&lt; 3.0'
</code></pre>

<p>RubyGems provides a shortcut for this, commonly known as the
<a href="http://robots.thoughtbot.com/post/2508037841/twiddle-wakka">twiddle-wakka</a>:</p>

<pre><code># gemspec
spec.add_runtime_dependency 'library',
  '~&gt; 2.2'

# bundler
gem 'library', '~&gt; 2.2'
</code></pre>

<p>Notice that we dropped the <code>PATCH</code> level of the version number. Had we said
<code>~&gt; 2.2.0</code>, that would have been equivalent to <code>['&gt;= 2.2.0', '&lt; 2.3.0']</code>.</p>

<p>If you want to allow use of newer backwards-compatible versions but need a
specific bug fix you can use a compound requirement:</p>

<pre><code># gemspec
spec.add_runtime_dependency 'library', '~&gt; 2.2', '&gt;= 2.2.1'

# bundler
gem 'library', '~&gt; 2.2', '&gt;= 2.2.1'
</code></pre>

<p>The important note to take home here is to be aware others <em>will</em> be using
your gems, so guard yourself from potential bugs/failures in future releases
by using <code>~&gt;</code> instead of <code>&gt;=</code> if at all possible.</p>

<blockquote>
  <p>If you’re dealing with a lot of gem dependencies in your application, we
recommend that you take a look into <a href="http://bundler.io">Bundler</a> or
<a href="https://github.com/jbarnette/isolate">Isolate</a> which do a great job of
managing a complex version manifest for many gems.</p>
</blockquote>

<p>If you want to allow prereleases and regular releases use a compound
requirement:</p>

<pre><code># gemspec
spec.add_runtime_dependency 'library', '&gt;= 2.0.0.a', '&lt; 3'
</code></pre>

<p>Using <code>~&gt;</code> with prerelease versions will restrict you to prerelease versions
only.</p>

<h3 id="requiring-rubygems">Requiring RubyGems</h3>

<p>Summary: don’t.</p>

<p>This line…</p>

<pre><code>require 'rubygems'
</code></pre>

<p>…should not be necessary in your gem code, since RubyGems is loaded
already when a gem is required.  Not having <code>require 'rubygems'</code> in your code
means that the gem can be easily used without needing the RubyGems client to
run.</p>

<p>For more information please check out <a href="http://tomayko.com/writings/require-rubygems-antipattern">Ryan
Tomayko’s</a> original
post about the subject.</p>

<h2 id="loading-code">Loading code</h2>

<p>At its core, RubyGems exists to help you manage Ruby’s <code>$LOAD_PATH</code>, which is
how the <code>require</code> statement picks up new code. There’s several things you can
do to make sure you’re loading code the right way.</p>

<h3 id="respect-the-global-load-path">Respect the global load path</h3>

<p>When packaging your gem files, you need to be careful of what is in your <code>lib</code>
directory. Every gem you have installed gets its <code>lib</code> directory appended onto
your <code>$LOAD_PATH</code>. This means any file on the top level of the <code>lib</code> directory
could get required.</p>

<p>For example, let’s say we have a <code>foo</code> gem with the following structure:</p>

<pre><code>.
└── lib
    ├── foo
    │   └── cgi.rb
    ├── erb.rb
    ├── foo.rb
    └── set.rb
</code></pre>

<p>This might seem harmless since your custom <code>erb</code> and <code>set</code> files are within
your gem.  However, this is not harmless, anyone who requires this gem will not
be able to bring in the
<a href="http://ruby-doc.org/stdlib/libdoc/erb/rdoc/classes/ERB.html">ERB</a> or
<a href="http://www.ruby-doc.org/stdlib/libdoc/set/rdoc/classes/Set.html">Set</a> classes
provided by Ruby’s standard library.</p>

<p>The best way to get around this is to keep files in a different directory
under <code>lib</code>. The usual convention is to be consistent and put them in the same
folder name as your gem’s name, for example <code>lib/foo/cgi.rb</code>.</p>

<h3 id="requiring-files-relative-to-each-other">Requiring files relative to each other</h3>

<p>Gems should not have to use <code>__FILE__</code> to bring in other Ruby files in your
gem. Code like this is surprisingly common in gems:</p>

<pre><code>require File.join(
          File.dirname(__FILE__),
          "foo", "bar")
</code></pre>

<p>Or:</p>

<pre><code>require File.expand_path(File.join(
          File.dirname(__FILE__),
          "foo", "bar"))
</code></pre>

<p>The fix is simple, just require the file relative to the load path:</p>

<pre><code>require 'foo/bar'
</code></pre>

<p>Or use require_relative:</p>

<pre><code>require_relative 'foo/bar'
</code></pre>

<p>The <a href="/make-your-own-gem">make your own gem</a> guide has a great example of this
behavior in practice, including a working test suite. The code for that gem is
<a href="https://github.com/qrush/hola">on GitHub</a> as well.</p>

<h3 id="mangling-the-load-path">Mangling the load path</h3>

<p>Gems should not change the <code>$LOAD_PATH</code> variable.  RubyGems manages this for
you.  Code like this should not be necessary:</p>

<pre><code>lp = File.expand_path(File.dirname(__FILE__))
unless $LOAD_PATH.include?(lp)
  $LOAD_PATH.unshift(lp)
end
</code></pre>

<p>Or:</p>

<pre><code>__DIR__ = File.dirname(__FILE__)

$LOAD_PATH.unshift __DIR__ unless
  $LOAD_PATH.include?(__DIR__) ||
  $LOAD_PATH.include?(File.expand_path(__DIR__))
</code></pre>

<p>When RubyGems activates a gem, it adds your package’s <code>lib</code> folder to the
<code>$LOAD_PATH</code> ready to be required normally by another lib or application.  It
is safe to assume you can then <code>require</code> any file in your <code>lib</code> folder.</p>

<h2 id="prerelease-gems">Prerelease gems</h2>

<p>Many gem developers have versions of their gem ready to go out for testing or
“edge” releases before a big gem release. RubyGems supports the concept of
“prerelease” versions, which could be betas, alphas, or anything else that
isn’t ready as a regular release.</p>

<p>Taking advantage of this is easy. All you need is one or more letters in the
gem version.  For example, here’s what a prerelease gemspec’s <code>version</code> field
might look like:</p>

<pre><code>Gem::Specification.new do |s|
  s.name = "hola"
  s.version = "1.0.0.pre"
</code></pre>

<p>Other prerelease version numbers might include <code>2.0.0.rc1</code>, or <code>1.5.0.beta.3</code>.
It just has to have a letter in it, and you’re set. These gems can then be
installed with the <code>--pre</code> flag, like so:</p>

<pre><code>% gem list factory_girl -r --pre

*** REMOTE GEMS ***

factory_girl (2.0.0.beta2, 2.0.0.beta1)
factory_girl_rails (1.1.beta1)

% gem install factory_girl --pre
Successfully installed factory_girl-2.0.0.beta2
1 gem installed
</code></pre>

<h2 id="credits">Credits</h2>

<p>Several sources were used for content for this guide:</p>

<ul>
  <li><a href="http://yehudakatz.com/2009/07/24/rubygems-good-practice/">Rubygems Good Practice</a></li>
  <li><a href="http://weblog.rubyonrails.org/2009/9/1/gem-packaging-best-practices">Gem Packaging: Best Practices</a></li>
</ul>

            </div>
          </div>
        </div>

        <div class="paginated-nav-links">
          <a class="paginated-nav-link--prev" data-icon="&lt;" href="/security">
            <span>Previous</span>
          </a>
          <a class="paginated-nav-link--next" data-icon="&gt;" href="/specification-reference">
            <span>Next</span>
          </a>
        </div>
      </div>
    </main>

    <div class="modal-wrap" id="js-sign-in-modal">
      <form class="modal--sign-in">
        <a class="modal__close" data-icon="x" href="#" id="js-sign-in-close">
          <span class="t-hidden">Close modal</span>
        </a>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="email">Email or Username</label>
          <input class="modal__input" id="email" name="email" placeholder="Email or Username" type="text">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="password">Password</label>
          <input class="modal__input" id="password" name="password" placeholder="Password" type="password">
        </div>
        <button class="modal__submit" data-icon="&gt;" type="submit">Sign in</button>
      </form>
    </div>

    <div class="modal-wrap" id="js-sign-up-modal">
      <form class="modal--sign-up">
        <a class="modal__close" data-icon="x" href="#" id="js-sign-up-close">
          <span class="t-hidden">Close modal</span>
        </a>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="email">Email</label>
          <input class="modal__input" id="email" name="email" placeholder="Email" type="email">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="username">Username</label>
          <input class="modal__input" id="username" name="username" placeholder="Username" type="text">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="password">Password</label>
          <input class="modal__input" id="password" name="password" placeholder="Password" type="password">
        </div>
        <button class="modal__submit" data-icon="&gt;" type="submit">Sign up</button>
      </form>
    </div>

    <footer class="footer">
      <div class="l-wrap--footer">
        <div class="l-overflow">
          <div class="nav--v l-col--r--pad">
            <a class="nav--v__link--footer" href="/status">Status</a>
            <a class="nav--v__link--footer" href="/uptime">Uptime</a>
            <a class="nav--v__link--footer" href="https://github.com/rubygems/rubygems.org" target='_blank'>Code</a>
            <a class="nav--v__link--footer" href="https://groups.google.com/forum/#!forum/rubygems-org" target='_blank'>Discuss</a>
            <a class="nav--v__link--footer" href="/stats">Stats</a>
            <a class="nav--v__link--footer" href="/blogs">Blog</a>
            <a class="nav--v__link--footer" href="/about">About</a>
            <a class="nav--v__link--footer" href="/help">Help</a>
          </div>
          <div class="l-colspan--l colspan--l--has-border">
            <p class="footer__about">RubyGems.org is the Ruby community&rsquo;s gem hosting service. Instantly publish your gems and install them. Use the API to interact and find out more information about available gems. Become a contributor and enhance the site with your own changes.</p>
          </div>
        </div>
      </div>
      <div class="footer__sponsors-wrap">
        <div class="footer__sponsors">
          <a class="footer__sponsor" href="http://rubycentral.org/" target="_blank">
            Supported by
            <img alt="Ruby Central" class="footer__sponsor__logo" src="/images/logos/ruby-central.png">
          </a>
          <a class="footer__sponsor" href="https://www.bluebox.net/" target="_blank">
            Hosted by
            <img alt="Blue Box" class="footer__sponsor__logo" src="/images/logos/bluebox.png">
          </a>
          <a class="footer__sponsor" href="http://www.dockyard.com/" target="_blank">
            Designed by
            <img alt="DockYard" class="footer__sponsor__logo" src="/images/logos/dockyard.png">
          </a>
          <a class="footer__sponsor" href="https://dnsimple.com/" target="_blank">
            Resolved with
            <img alt="DNSimple" class="footer__sponsor__logo" src="/images/logos/dnsimple.png">
          </a>
          <a class="footer__sponsor" href="http://newrelic.com/" target="_blank">
            Optimized by
            <img alt="New Relic" class="footer__sponsor__logo" src="/images/logos/new-relic.png">
          </a>
          <a class="footer__sponsor" href="http://get.gaug.es/" target="_blank">
            Tracking by
            <img alt="Gauges" class="footer__sponsor__logo" src="/images/logos/gauges.png">
          </a>
          <a class="footer__sponsor" href="https://www.runscope.com/" target="_blank">
            Monitored by
            <img alt="Runscope" class="footer__sponsor__logo" src="/images/logos/runscope.png">
          </a>
        </div>
      </div>
    </footer>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10315684-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
