<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Security - RubyGems Guides</title>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta http-equiv="Description" name="Description" content="Tutorials, guides, FAQs for RubyGems package management" />
    <meta http-equiv="Keywords" name="Keywords" content="rubygems, gems, programming, ruby, packages" />
    <script src="//use.typekit.net/lkc4mmu.js" type="text/javascript"></script>
    <script>
      try{Typekit.load();}catch(e){}
    </script>
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>
      $(function() {
        var path = window.location.pathname;
        $('a[href="'+path.substring(0, path.length -1)+'"]').addClass('is-active');
      });
    </script>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" name="viewport">
    <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
    <!--[if !IE]>-->
      <meta name="viewport" content="width=device-width">
      <script type="text/javascript">
        window.scrollTo(0, 1);
      </script>
    <!--<![endif]-->
  </head>

  <body class="default">
    <header class="header header--interior">
      <div class="l-wrap--header">
        <a class="header__logo-wrap" href="/">
          <span class="header__logo" data-icon="⬡">⬢</span>
          <span class="t-hidden">RubyGems</span>
        </a>
        <a class="header__club-sandwich" href="#">
          <span class="t-hidden">Navigation menu</span>
        </a>

        <div class="header__nav-links-wrap">
          <form class="header__search-wrap">
            <input class="header__search" id="header__search" name="header__search" placeholder="Search Gems..." type="search">
            <label class="header__search__icon" data-icon="⌕" for="header__search">
              <span class="t-hidden">Search gems</span>
            </label>
          </form>

          <nav class="header__nav-links">
            <a class="header__nav-link" href="/gems">Gems</a>
            <a class="header__nav-link" href="/guides">Guides</a>
            <a class="header__nav-link" href="/contribute">Contribute</a>
            <a class="header__nav-link" href="#" id="js-sign-in-trigger">Sign In</a>
            <a class="header__nav-link js-sign-up-trigger" href="#">Sign Up</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="main--interior">
      <div class="l-wrap--b">
        <a class="t-display page__heading" href="/">Guides</a>
        <div class="l-overflow">
          <div class="l-col--l">
            <div class="nav--v">
              <a class="nav--v__link" href="/rubygems-basics">RubyGems Basics</a>
              <a class="nav--v__link" href="/what-is-a-gem">What is a gem?</a>
              <a class="nav--v__link" href="/make-your-own-gem">Make your own gem</a>
              <a class="nav--v__link" href="/gems-with-extensions">Gems with Extensions</a>
              <a class="nav--v__link" href="/name-your-gem">Name your gem</a>
              <a class="nav--v__link" href="/publishing">Publishing your gem</a>
              <a class="nav--v__link" href="/security">Security Practices</a>
              <a class="nav--v__link" href="/patterns">Patterns</a>
              <a class="nav--v__link" href="/specification-reference">Specification Reference</a>
              <a class="nav--v__link" href="/command-reference">Command Reference</a>
              <a class="nav--v__link" href="http://docs.seattlerb.org/rubygems">RubyGems API</a>
              <a class="nav--v__link" href="/rubygems-org-api">RubyGems.org API</a>
              <a class="nav--v__link" href="/run-your-own-gem-server">Run your own gem server</a>
              <a class="nav--v__link" href="/resources">Resources</a>
              <a class="nav--v__link" href="/contributing">Contributing to RubyGems</a>
              <a class="nav--v__link" href="/faqs">Frequently Asked Questions</a>
              <a class="nav--v__link" href="/plugins">Plugins</a>
              <a class="nav--v__link" href="/credits">Credits</a>
            </div>
          </div>
          <div class="l-colspan--r">
            <div class="t-body">
              <p><em class="t-gray">How to build and install cryptographically signed gems– and other security concerns.</em></p>

<p>Security practices are being actively discussed. Check back often.</p>

<ul>
  <li><a href="#general">General</a></li>
  <li><a href="#using-gems">Using Gems</a></li>
  <li><a href="#building-gems">Building Gems</a></li>
  <li><a href="#reporting-security-vulnerabilities">Reporting Security Vulnerabilities</a></li>
</ul>

<h2 id="general">General</h2>

<p>Installing a gem allows that gem’s code to run in the context of your
application. Clearly this has security implications: installing a malicious gem
on a server could ultimately result in that server being completely penetrated
by the gem’s author. Because of this, the security of gem code is a topic of
active discussion within the Ruby community.</p>

<p>RubyGems has had the ability to <a href="http://docs.seattlerb.org/rubygems/Gem/Security.html">cryptographically sign
gems</a> since version
0.8.11. This signing works by using the <code>gem cert</code> command to create a key
pair, and then packaging signing data inside the gem itself. The <code>gem install</code>
command optionally lets you set a security policy, and you can verify the
signing key for a gem before you install it.</p>

<p>However, this method of securing gems is not widely used. It requires a number
of <a href="#building_gems">manual steps on the part of the developer</a>, and there is no
well-established chain of trust for gem signing keys.  Discussion of new
signing models such as X509 and OpenPGP is going on in the <a href="https://github.com/rubygems-trust/rubygems.org/wiki/_pages">rubygems-trust
wiki</a>, the
<a href="https://groups.google.com/d/msg/rubygems-developers/lnnGTlfsuYo/TLDcJ2RPSDoJ">RubyGems-Developers
list</a>
and in <a href="irc://chat.freenode.net/#rubygems-trust">IRC</a>. The goal is to improve
(or replace) the signing system so that it is easy for authors and transparent
for users.</p>

<h2 id="using-gems">Using Gems</h2>

<p>Install with a trust policy.</p>

<ul>
  <li>
    <p><code>gem install gemname -P HighSecurity</code>: All dependent gems must be signed
and verified.</p>
  </li>
  <li>
    <p><code>gem install gemname -P MediumSecurity</code>: All signed dependent gems must be
verified.</p>
  </li>
  <li>
    <p><code>bundle --trust-policy MediumSecurity</code>: Same as above, except Bundler only
recognizes the long <code>--trust-policy</code> flag, not the short <code>-P</code>.</p>
  </li>
  <li>
    <p><em>Caveat:</em> Gem certificates are trusted globally, such that adding a
cert.pem for one gem automatically trusts all gems signed by that cert.</p>
  </li>
</ul>

<p>Verify the checksum, if available</p>

<pre><code>gem fetch gemname -v version
ruby -rdigest/sha2 -e "puts Digest::SHA512.new.hexdigest(File.read('gemname-version.gem'))
</code></pre>

<p>Know the risks of being pwned, as described by <a href="http://lanyrd.com/2013/rulu/scgxzr/">Benjamin Smith’s Hacking with Gems talk</a></p>

<h2 id="building-gems">Building Gems</h2>

<h3 id="sign-with-gem-cert">Sign with: <code>gem cert</code></h3>

<p>1) Create self-signed gem cert</p>

<pre><code>cd ~/.ssh
gem cert --build your@email.com
chmod 600 gem-p*
</code></pre>

<ul>
  <li>use the email address you specify in your gemspecs</li>
</ul>

<p>2) Configure gemspec with cert</p>

<p>Add cert public key to your repository</p>

<pre><code>cd /path/to/your/gem
mkdir certs
cp ~/.ssh/gem-public_cert.pem certs/yourhandle.pem
git add certs/yourhandle.pem
</code></pre>

<p>Add cert paths to your gemspec</p>

<pre><code>s.cert_chain  = ['certs/yourhandle.pem']
s.signing_key = File.expand_path("~/.ssh/gem-private_key.pem") if $0 =~ /gem\z/
</code></pre>

<p>3) Add your own cert to your approved list, just like anyone else</p>

<pre><code>gem cert --add certs/yourhandle.pem
</code></pre>

<p>4) Build gem and test that you can install it</p>

<pre><code>gem build gemname.gemspec
gem install gemname-version.gem -P HighSecurity
# or -P MediumSecurity if your gem depends on unsigned gems
</code></pre>

<p>5) Example text for installation documentation</p>

<blockquote>
  <p>MetricFu is cryptographically signed. To be sure the gem you install hasn’t been tampered with:</p>

  <p>Add my public key (if you haven’t already) as a trusted certificate</p>

  <p><code>gem cert --add &lt;(curl -Ls https://raw.github.com/metricfu/metric_fu/master/certs/bf4.pem)</code></p>

  <p><code>gem install metric_fu -P MediumSecurity</code></p>

  <p>The MediumSecurity trust profile will verify signed gems, but allow the installation of unsigned dependencies.</p>

  <p>This is necessary because not all of MetricFu’s dependencies are signed, so we cannot use HighSecurity.</p>
</blockquote>

<hr />

<h3 id="include-checksum-of-released-gems-in-your-repository">Include checksum of released gems in your repository</h3>

<pre><code>require 'digest/sha2'
built_gem_path = 'pkg/gemname-version.gem'
checksum = Digest::SHA512.new.hexdigest(File.read(built_gem_path))
checksum_path = 'checksum/gemname-version.gem.sha512'
File.open(checksum_path, 'w' ) {|f| f.write(checksum) }
# add and commit 'checksum_path'
</code></pre>

<hr />

<h3 id="not-recommended-openpgp-signing-is-not-recommended-due-to-lack-of">Not Recommended: OpenPGP signing is [not recommended due to lack of</h3>
<p>support](http://www.rubygems-openpgp-ca.org/blog/nobody-cares-about-signed-gems.html).</p>

<p>For details, see discussion <a href="https://github.com/rubygems/guides/pull/70#issuecomment-29007487">with Yorick
Peterse</a>.</p>

<h2 id="reporting-security-vulnerabilities">Reporting Security vulnerabilities</h2>

<h3 id="reporting-a-security-vulnerability-with-someone-elses-gem">Reporting a security vulnerability with someone else’s gem</h3>

<p>If you spot a security vulnerability in someone else’s gem, then you
first step should be to check whether this is a known vulnerability.</p>

<p>If this looks like a newly discovered vulnerability then you should
contact the author(s) privately (i.e. not via a pull request or issue on public
project) explaining the issue, how it can be exploited and ideally offering an
indication of how it might be fixed.</p>

<h3 id="reporting-a-security-vulnerability-with-your-own-gem">Reporting a security vulnerability with your own gem</h3>

<p>Firstly request a <a href="https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures">CVE
identifier</a>
by mailing cve-assign@mitre.org. This identifier will make it easy to
uniquely identify the vulnerability when talking about it.</p>

<p>Secondly work out what people who depend on your gem should do to
resolve the vulnerability. This may involve releasing a patched version of you gem
that you can recommend they upgrade to.</p>

<p>Finally you need to tell people about the vulnerability. Currently there
is no single place to broadcast this information but a good place to
start might be to:</p>

<ul>
  <li>
    <p>Send an email to the Ruby Talk mailing list (ruby-talk@ruby-lang.org)
with the subject prefix [ANN][Security] outlining the vulnerabilty,
which versions of your gem it affects and what actions those depending
on the gem should take.</p>
  </li>
  <li>
    <p>Add it to an open source vulnerability database like
<a href="http://osvdb.org/">OSVDB</a>. You can do this by emailing moderators@osvdb.org
and/or messaging @osvdb on GitHub or Twitter.</p>
  </li>
</ul>

<h2 id="credits">Credits</h2>

<p>Several sources were used for content for this guide:</p>

<ul>
  <li><a href="http://www.benjaminfleischer.com/2013/11/08/how-to-sign-your-rubygem-cert/">How to cryptographically sign your RubyGem</a> - Step-by-step guide</li>
  <li><a href="http://developer.zendesk.com/blog/2013/02/03/signing-gems/">Signing rubygems - Pasteable instructions</a></li>
  <li><a href="https://github.com/sferik/twitter/blob/master/twitter.gemspec">Twitter gem gemspec</a></li>
  <li><a href="https://github.com/rubygems-trust/rubygems.org/wiki/Overview">RubyGems Trust Model Overview</a>, <a href="http://goo.gl/ybFIO">doc</a></li>
  <li><a href="http://tonyarcieri.com/lets-figure-out-a-way-to-start-signing-rubygems">Let’s figure out a way to start signing RubyGems</a></li>
  <li><a href="http://blog.meldium.com/home/2013/3/6/signing-gems-how-to">A Practical Guide to Using Signed Ruby Gems - Part 3: Signing your Own</a></li>
  <li>Also see the <a href="/resources">Resources</a> page.</li>
</ul>

            </div>
          </div>
        </div>

        <div class="paginated-nav-links">
          <a class="paginated-nav-link--prev" data-icon="&lt;" href="/publishing">
            <span>Previous</span>
          </a>
          <a class="paginated-nav-link--next" data-icon="&gt;" href="/patterns">
            <span>Next</span>
          </a>
        </div>
      </div>
    </main>

    <div class="modal-wrap" id="js-sign-in-modal">
      <form class="modal--sign-in">
        <a class="modal__close" data-icon="x" href="#" id="js-sign-in-close">
          <span class="t-hidden">Close modal</span>
        </a>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="email">Email or Username</label>
          <input class="modal__input" id="email" name="email" placeholder="Email or Username" type="text">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="password">Password</label>
          <input class="modal__input" id="password" name="password" placeholder="Password" type="password">
        </div>
        <button class="modal__submit" data-icon="&gt;" type="submit">Sign in</button>
      </form>
    </div>

    <div class="modal-wrap" id="js-sign-up-modal">
      <form class="modal--sign-up">
        <a class="modal__close" data-icon="x" href="#" id="js-sign-up-close">
          <span class="t-hidden">Close modal</span>
        </a>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="email">Email</label>
          <input class="modal__input" id="email" name="email" placeholder="Email" type="email">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="username">Username</label>
          <input class="modal__input" id="username" name="username" placeholder="Username" type="text">
        </div>
        <div class="modal__input-wrap">
          <label class="modal__label t-hidden" for="password">Password</label>
          <input class="modal__input" id="password" name="password" placeholder="Password" type="password">
        </div>
        <button class="modal__submit" data-icon="&gt;" type="submit">Sign up</button>
      </form>
    </div>

    <footer class="footer">
      <div class="l-wrap--footer">
        <div class="l-overflow">
          <div class="nav--v l-col--r--pad">
            <a class="nav--v__link--footer" href="/status">Status</a>
            <a class="nav--v__link--footer" href="/uptime">Uptime</a>
            <a class="nav--v__link--footer" href="https://github.com/rubygems/rubygems.org" target='_blank'>Code</a>
            <a class="nav--v__link--footer" href="https://groups.google.com/forum/#!forum/rubygems-org" target='_blank'>Discuss</a>
            <a class="nav--v__link--footer" href="/stats">Stats</a>
            <a class="nav--v__link--footer" href="/blogs">Blog</a>
            <a class="nav--v__link--footer" href="/about">About</a>
            <a class="nav--v__link--footer" href="/help">Help</a>
          </div>
          <div class="l-colspan--l colspan--l--has-border">
            <p class="footer__about">RubyGems.org is the Ruby community&rsquo;s gem hosting service. Instantly publish your gems and install them. Use the API to interact and find out more information about available gems. Become a contributor and enhance the site with your own changes.</p>
          </div>
        </div>
      </div>
      <div class="footer__sponsors-wrap">
        <div class="footer__sponsors">
          <a class="footer__sponsor" href="http://rubycentral.org/" target="_blank">
            Supported by
            <img alt="Ruby Central" class="footer__sponsor__logo" src="/images/logos/ruby-central.png">
          </a>
          <a class="footer__sponsor" href="https://www.bluebox.net/" target="_blank">
            Hosted by
            <img alt="Blue Box" class="footer__sponsor__logo" src="/images/logos/bluebox.png">
          </a>
          <a class="footer__sponsor" href="http://www.dockyard.com/" target="_blank">
            Designed by
            <img alt="DockYard" class="footer__sponsor__logo" src="/images/logos/dockyard.png">
          </a>
          <a class="footer__sponsor" href="https://dnsimple.com/" target="_blank">
            Resolved with
            <img alt="DNSimple" class="footer__sponsor__logo" src="/images/logos/dnsimple.png">
          </a>
          <a class="footer__sponsor" href="http://newrelic.com/" target="_blank">
            Optimized by
            <img alt="New Relic" class="footer__sponsor__logo" src="/images/logos/new-relic.png">
          </a>
          <a class="footer__sponsor" href="http://get.gaug.es/" target="_blank">
            Tracking by
            <img alt="Gauges" class="footer__sponsor__logo" src="/images/logos/gauges.png">
          </a>
          <a class="footer__sponsor" href="https://www.runscope.com/" target="_blank">
            Monitored by
            <img alt="Runscope" class="footer__sponsor__logo" src="/images/logos/runscope.png">
          </a>
        </div>
      </div>
    </footer>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10315684-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
